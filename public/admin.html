<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€ - ì„ ìƒ¤ì¸íˆ¬ì–´</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans KR', sans-serif; background: #f5f7fa; color: #2c3e50; }
        
        /* Login Screen */
        .login-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .login-box { background: white; padding: 3rem; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); width: 100%; max-width: 400px; }
        .login-title { text-align: center; margin-bottom: 2rem; color: #2c3e50; font-size: 1.8rem; }
        .form-group { margin-bottom: 1.5rem; }
        .form-label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #34495e; }
        .form-input { width: 100%; padding: 0.75rem 1rem; border: 2px solid #e0e6ed; border-radius: 8px; font-size: 1rem; }
        .form-input:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,0.1); }
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: #667eea; color: white; width: 100%; }
        .btn-primary:hover { background: #5568d3; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102,126,234,0.4); }
        .error-message { background: #e74c3c; color: white; padding: 0.75rem; border-radius: 8px; margin-bottom: 1rem; text-align: center; }
        
        /* Admin Panel */
        .admin-container { display: none; min-height: 100vh; }
        .admin-header { background: white; padding: 1.5rem 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .admin-title { font-size: 1.5rem; font-weight: 700; color: #2c3e50; }
        .btn-logout { background: #e74c3c; color: white; padding: 0.5rem 1.5rem; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .btn-logout:hover { background: #c0392b; }
        
        .admin-content { padding: 2rem; max-width: 1400px; margin: 0 auto; }
        
        /* Navigation Steps */
        .breadcrumb { background: white; padding: 1rem 2rem; margin-bottom: 2rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .breadcrumb-item { display: inline-block; color: #7f8c8d; font-size: 0.9rem; }
        .breadcrumb-item.active { color: #667eea; font-weight: 600; }
        .breadcrumb-separator { margin: 0 0.5rem; color: #bdc3c7; }
        .btn-back { background: #95a5a6; color: white; padding: 0.5rem 1rem; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; margin-bottom: 1rem; }
        .btn-back:hover { background: #7f8c8d; }
        
        /* Destination Grid */
        .destination-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; }
        .destination-card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); text-align: center; cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
        .destination-card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(0,0,0,0.15); border-color: #667eea; }
        .destination-icon { font-size: 3rem; margin-bottom: 1rem; }
        .destination-name { font-size: 1.2rem; font-weight: 600; color: #2c3e50; }
        
        /* Region Grid */
        .region-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; }
        .region-card { background: white; padding: 1.5rem; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); text-align: center; cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
        .region-card:hover { transform: translateY(-3px); box-shadow: 0 6px 16px rgba(0,0,0,0.12); border-color: #3498db; }
        .region-name { font-size: 1rem; font-weight: 600; color: #2c3e50; }
        
        /* Resort Management */
        .resort-section { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); margin-bottom: 2rem; }
        .section-title { font-size: 1.3rem; font-weight: 700; color: #2c3e50; margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid #ecf0f1; }
        .btn-add { background: #27ae60; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; margin-bottom: 1.5rem; }
        .btn-add:hover { background: #229954; }
        
        /* Resort Form */
        .resort-form { display: none; background: #ecf0f1; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; }
        .resort-form.active { display: block; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 1rem; }
        .form-control { width: 100%; padding: 0.75rem; border: 2px solid #bdc3c7; border-radius: 6px; font-size: 0.95rem; }
        .form-control:focus { outline: none; border-color: #3498db; }
        .btn-submit { background: #3498db; color: white; padding: 0.75rem 2rem; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; margin-right: 0.5rem; }
        .btn-submit:hover { background: #2980b9; }
        .btn-cancel { background: #95a5a6; color: white; padding: 0.75rem 2rem; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .btn-cancel:hover { background: #7f8c8d; }
        
        /* Resort List */
        .resort-list { display: grid; gap: 1rem; }
        .resort-item { background: #f8f9fa; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #3498db; display: flex; justify-content: space-between; align-items: center; }
        .resort-info h4 { font-size: 1.1rem; color: #2c3e50; margin-bottom: 0.5rem; }
        .resort-info p { font-size: 0.9rem; color: #7f8c8d; }
        .resort-actions { display: flex; gap: 0.5rem; }
        .btn-edit { background: #f39c12; color: white; padding: 0.5rem 1rem; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; }
        .btn-edit:hover { background: #e67e22; }
        .btn-delete { background: #e74c3c; color: white; padding: 0.5rem 1rem; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; }
        .btn-delete:hover { background: #c0392b; }
        .btn-toggle { background: #95a5a6; color: white; padding: 0.5rem 1rem; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; }
        .btn-toggle:hover { background: #7f8c8d; }
        .btn-toggle.active { background: #27ae60; }
        
        .hidden { display: none; }
        
        /* Notification Settings */
        .notification-badge { position: absolute; top: -5px; right: -5px; background: #e74c3c; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 0.7rem; display: flex; align-items: center; justify-content: center; font-weight: 700; }
        .notification-settings { position: relative; }
        .btn-notification { background: #3498db; color: white; padding: 0.5rem 1.5rem; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; margin-right: 1rem; position: relative; }
        .btn-notification:hover { background: #2980b9; }
        .notification-panel { display: none; position: absolute; top: 100%; right: 0; background: white; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); padding: 1.5rem; width: 350px; margin-top: 0.5rem; z-index: 1000; }
        .notification-panel.active { display: block; }
        .notification-item { padding: 0.75rem; background: #f8f9fa; border-radius: 6px; margin-bottom: 0.75rem; border-left: 3px solid #3498db; }
        .notification-item.unread { background: #e3f2fd; border-left-color: #e74c3c; }
        .notification-title { font-weight: 600; color: #2c3e50; margin-bottom: 0.25rem; }
        .notification-text { font-size: 0.9rem; color: #7f8c8d; }
        .notification-time { font-size: 0.8rem; color: #95a5a6; margin-top: 0.25rem; }
        .settings-form { margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #ecf0f1; }
        .settings-form label { display: flex; align-items: center; margin-bottom: 0.75rem; cursor: pointer; }
        .settings-form input[type="checkbox"] { margin-right: 0.5rem; width: 18px; height: 18px; cursor: pointer; }
        .settings-form input[type="email"] { width: 100%; padding: 0.5rem; border: 2px solid #e0e6ed; border-radius: 6px; margin-top: 0.5rem; }
        .btn-save-settings { background: #27ae60; color: white; padding: 0.5rem 1rem; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; width: 100%; margin-top: 0.75rem; }
        .btn-save-settings:hover { background: #229954; }
        
        /* Tab Navigation */
        .tab-navigation { background: white; padding: 0; margin-bottom: 2rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; overflow: hidden; }
        .tab-button { flex: 1; padding: 1.25rem 2rem; border: none; background: white; color: #7f8c8d; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; border-bottom: 3px solid transparent; }
        .tab-button:hover { background: #f8f9fa; color: #2c3e50; }
        .tab-button.active { color: #667eea; border-bottom-color: #667eea; background: #f8f9fa; }
        .tab-button i { margin-right: 0.5rem; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-box">
            <h2 class="login-title">ğŸŒ… ì„ ìƒ¤ì¸íˆ¬ì–´ ê´€ë¦¬ì</h2>
            <div id="loginError" class="error-message hidden">ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="passwordInput" class="form-input" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <button type="submit" class="btn btn-primary">ë¡œê·¸ì¸</button>
            </form>
        </div>
    </div>

    <!-- Admin Panel -->
    <div class="admin-container" id="adminPanel">
        <!-- Header -->
        <div class="admin-header">
            <h1 class="admin-title">ì„ ìƒ¤ì¸íˆ¬ì–´ ê´€ë¦¬ì</h1>
            <div style="display: flex; align-items: center;">
                <div class="notification-settings">
                    <button class="btn-notification" onclick="toggleNotificationPanel()">
                        <i class="fas fa-bell"></i> ì•Œë¦¼
                        <span class="notification-badge hidden" id="notificationBadge">0</span>
                    </button>
                    
                    <!-- Notification Panel -->
                    <div class="notification-panel" id="notificationPanel">
                        <h3 style="margin-bottom: 1rem; color: #2c3e50;">ì•Œë¦¼ ì„¼í„°</h3>
                        
                        <!-- Notification List -->
                        <div id="notificationList" style="max-height: 300px; overflow-y: auto; margin-bottom: 1rem;">
                            <!-- Notifications will be inserted here -->
                        </div>
                        
                        <!-- Settings -->
                        <div class="settings-form">
                            <h4 style="margin-bottom: 0.75rem; color: #2c3e50;">ì•Œë¦¼ ì„¤ì •</h4>
                            <label>
                                <input type="checkbox" id="enableBrowserNotification" onchange="saveSoundSettings()">
                                ë¸Œë¼ìš°ì € ì•Œë¦¼ í™œì„±í™”
                            </label>
                            <label>
                                <input type="checkbox" id="enableEmailNotification" onchange="toggleEmailInput()">
                                ì´ë©”ì¼ ì•Œë¦¼ í™œì„±í™”
                            </label>
                            <div id="emailInputContainer" class="hidden">
                                <input type="email" id="notificationEmail" placeholder="ì•Œë¦¼ ë°›ì„ ì´ë©”ì¼">
                            </div>
                            <button class="btn-save-settings" onclick="saveNotificationSettings()">ì„¤ì • ì €ì¥</button>
                        </div>
                    </div>
                </div>
                <button class="btn-logout" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <!-- Content -->
        <div class="admin-content">
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-button active" onclick="switchTab('resort')">
                    <i class="fas fa-hotel"></i> ë¦¬ì¡°íŠ¸ ê´€ë¦¬
                </button>
                <button class="tab-button" onclick="switchTab('review')">
                    <i class="fas fa-star"></i> í›„ê¸° ê´€ë¦¬
                </button>
                <button class="tab-button" onclick="switchTab('inquiry')">
                    <i class="fas fa-envelope"></i> ë¬¸ì˜ ê´€ë¦¬
                </button>
            </div>

            <!-- Resort Management Tab -->
            <div id="resortTab" class="tab-content active">
            <!-- Breadcrumb -->
            <div class="breadcrumb">
                <span class="breadcrumb-item" id="breadcrumb"></span>
            </div>

            <!-- Back Button -->
            <button class="btn-back hidden" id="backBtn" onclick="goBack()">
                <i class="fas fa-arrow-left"></i> ë’¤ë¡œê°€ê¸°
            </button>

            <!-- Step 1: Destination Selection -->
            <div id="destinationStep">
                <div class="resort-section">
                    <h2 class="section-title">ğŸ“ ëª©ì ì§€ ì„ íƒ</h2>
                    <div class="destination-grid" id="destinationGrid"></div>
                </div>
            </div>

            <!-- Step 2: Region Selection -->
            <div id="regionStep" class="hidden">
                <div class="resort-section">
                    <h2 class="section-title">ğŸ—ºï¸ <span id="currentDestinationName"></span> - ì§€ì—­ ì„ íƒ</h2>
                    <div class="region-grid" id="regionGrid"></div>
                </div>
            </div>

            <!-- Step 3: Resort Management -->
            <div id="resortStep" class="hidden">
                <div class="resort-section">
                    <h2 class="section-title">ğŸ¨ <span id="currentRegionName"></span> - ë¦¬ì¡°íŠ¸ ê´€ë¦¬</h2>
                    
                    <button class="btn-add" onclick="showResortForm()">
                        <i class="fas fa-plus"></i> ìƒˆ ë¦¬ì¡°íŠ¸ ì¶”ê°€
                    </button>

                    <!-- Resort Form -->
                    <div class="resort-form" id="resortForm">
                        <h3 style="margin-bottom: 1rem; color: #2c3e50;">ë¦¬ì¡°íŠ¸ ì •ë³´ ì…ë ¥</h3>
                        <form id="resortDataForm">
                            <div class="form-row">
                                <input type="text" class="form-control" id="resortName" placeholder="ë¦¬ì¡°íŠ¸ ì´ë¦„" required>
                                <input type="text" class="form-control" id="resortType" placeholder="ë¦¬ì¡°íŠ¸ íƒ€ì… (ì˜ˆ: 5ì„±ê¸‰, ëŸ­ì…”ë¦¬)">
                            </div>
                            <div class="form-row">
                                <input type="url" class="form-control" id="resortImage" placeholder="ì´ë¯¸ì§€ URL">
                                <input type="text" class="form-control" id="resortPrice" placeholder="ê°€ê²© (ì˜ˆ: $500/ë°•)">
                            </div>
                            <div class="form-row">
                                <textarea class="form-control" id="resortDescription" placeholder="ì„¤ëª…" rows="3" style="grid-column: 1 / -1;"></textarea>
                            </div>
                            <div class="form-row">
                                <input type="text" class="form-control" id="resortFeatures" placeholder="ì£¼ìš” íŠ¹ì§• (ì‰¼í‘œë¡œ êµ¬ë¶„)">
                            </div>
                            <div style="margin-top: 1rem;">
                                <button type="submit" class="btn-submit">ì €ì¥</button>
                                <button type="button" class="btn-cancel" onclick="hideResortForm()">ì·¨ì†Œ</button>
                            </div>
                        </form>
                    </div>

                    <!-- Resort List -->
                    <div class="resort-list" id="resortList"></div>
                </div>
            </div>
            </div>
            <!-- End Resort Management Tab -->

            <!-- Review Management Tab -->
            <div id="reviewTab" class="tab-content">
                <div class="resort-section">
                    <h2 class="section-title">â­ í›„ê¸° ê´€ë¦¬</h2>
                    
                    <button class="btn-add" onclick="showReviewForm()">
                        <i class="fas fa-plus"></i> ìƒˆ í›„ê¸° ì¶”ê°€
                    </button>

                    <!-- Review Form -->
                    <div class="resort-form" id="reviewForm">
                        <h3 style="margin-bottom: 1rem; color: #2c3e50;">í›„ê¸° ì •ë³´ ì…ë ¥</h3>
                        <form id="reviewDataForm">
                            <div class="form-row">
                                <input type="text" class="form-control" id="reviewAuthor" placeholder="ì‘ì„±ì ì´ë¦„" required>
                                <input type="text" class="form-control" id="reviewResort" placeholder="ë¦¬ì¡°íŠ¸ ì´ë¦„">
                            </div>
                            <div class="form-row">
                                <select class="form-control" id="reviewRating" required>
                                    <option value="">í‰ì  ì„ íƒ</option>
                                    <option value="5">â­â­â­â­â­ (5ì )</option>
                                    <option value="4">â­â­â­â­ (4ì )</option>
                                    <option value="3">â­â­â­ (3ì )</option>
                                    <option value="2">â­â­ (2ì )</option>
                                    <option value="1">â­ (1ì )</option>
                                </select>
                                <input type="date" class="form-control" id="reviewDate" required>
                            </div>
                            <div class="form-row">
                            <div class="form-row">
                                <input type="text" class="form-control" id="reviewTitle" placeholder="í›„ê¸° ì œëª©" required>
                            </div>
                            <div class="form-row">
                                <input type="file" class="form-control" id="reviewImages" multiple accept="image/*">
                                <small style="grid-column: 1 / -1; color: #666; font-size: 0.85rem;">ğŸ“· ìµœëŒ€ 5ì¥ê¹Œì§€ ì—…ë¡œë“œ ê°€ëŠ¥ (ê° 5MB ì´í•˜)</small>
                            </div>
                            <div id="imagePreview" style="grid-column: 1 / -1; display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;"></div>
                                <textarea class="form-control" id="reviewContent" placeholder="í›„ê¸° ë‚´ìš©" rows="4" style="grid-column: 1 / -1;" required></textarea>
                            </div>
                            <div style="margin-top: 1rem;">
                                <button type="submit" class="btn-submit">ì €ì¥</button>
                                <button type="button" class="btn-cancel" onclick="hideReviewForm()">ì·¨ì†Œ</button>
                            </div>
                        </form>
                    </div>

                    <!-- Review List -->
                    <div class="resort-list" id="reviewList"></div>
                </div>
            </div>
            <!-- End Review Management Tab -->

            <!-- Inquiry Management Tab -->
            <div id="inquiryTab" class="tab-content">
                <div class="resort-section">
                    <h2 class="section-title">ğŸ“§ ë¬¸ì˜ ê´€ë¦¬</h2>
                    
                    <!-- Filter Buttons -->
                    <div style="margin-bottom: 1.5rem;">
                        <button class="btn" style="background: #3498db; color: white; margin-right: 0.5rem;" onclick="filterInquiries('all')">ì „ì²´</button>
                        <button class="btn" style="background: #f39c12; color: white; margin-right: 0.5rem;" onclick="filterInquiries('pending')">ëŒ€ê¸°ì¤‘</button>
                        <button class="btn" style="background: #27ae60; color: white;" onclick="filterInquiries('completed')">ë‹µë³€ì™„ë£Œ</button>
                    </div>

                    <!-- Inquiry List -->
                    <div class="resort-list" id="inquiryList"></div>
                </div>
            </div>
            <!-- End Inquiry Management Tab -->

        </div>
    </div>

    <script>
        // Password
        const ADMIN_PASSWORD = 'sun2026@';
        
        // Destination and Region Structure
        const DESTINATIONS = {
            'íƒœêµ­': {
                icon: 'ğŸ‡¹ğŸ‡­',
                regions: ['í‘¸ì¼“', 'ì¹´ì˜¤ë½', 'ë„ë¼ë¹„', 'ì½”ì‚¬ë¬´ì´', 'íŒŒíƒ€ì•¼', 'ë°©ì½•']
            },
            'ì¸ë„ë„¤ì‹œì•„': {
                icon: 'ğŸ‡®ğŸ‡©',
                regions: ['ë°œë¦¬', 'ë¡¬ë³µ']
            },
            'í•˜ì™€ì´': {
                icon: 'ğŸŒº',
                regions: ['ì˜¤ì•„í›„', 'ë§ˆìš°ì´', 'ë¹…ì•„ì¼ëœë“œ', 'ì¹´ìš°ì•„ì´']
            },
            'ì¹¸ì¿¤': {
                icon: 'ğŸ‡²ğŸ‡½',
                regions: ['ì¹¸ì¿¤', 'í”Œë¼ì•¼ë¸ì¹´ë¥´ë©˜', 'íˆ´ë£¸']
            },
            'í•„ë¦¬í•€': {
                icon: 'ğŸ‡µğŸ‡­',
                regions: ['ë³´ë¼ì¹´ì´', 'ì„¸ë¶€', 'ë³´í™€', 'íŒ”ë¼ì™„']
            },
            'ëª°ë””ë¸Œ': {
                icon: 'ğŸ‡²ğŸ‡»',
                regions: ['ë¶ë§ë ˆ', 'ë‚¨ë§ë ˆ', 'ì•„ë¦¬', 'ë°”']
            },
            'ë‚¨íƒœí‰ì–‘': {
                icon: 'ğŸŒŠ',
                regions: ['í”¼ì§€', 'íƒ€íˆí‹°', 'ë‰´ì¹¼ë ˆë„ë‹ˆì•„', 'ì‚¬ëª¨ì•„']
            },
            'ë‹¤ë‚­': {
                icon: 'ğŸ‡»ğŸ‡³',
                regions: ['ë‹¤ë‚­', 'í˜¸ì´ì•ˆ']
            },
            'ëª¨ë¦¬ì…”ìŠ¤': {
                icon: 'ğŸ‡²ğŸ‡º',
                regions: ['ë¶ë¶€', 'ë™ë¶€', 'ì„œë¶€', 'ë‚¨ë¶€']
            }
        };

        // State Management
        let currentDestination = null;
        let currentRegion = null;
        let editingResortId = null;
        let editingReviewId = null;
        let resorts = {};
        let reviews = [];
        let inquiries = [];
        let notifications = JSON.parse(localStorage.getItem('notifications')) || [];
        let notificationSettings = JSON.parse(localStorage.getItem('notificationSettings')) || {
            browserNotification: false,
            emailNotification: false,
            email: '',
            lastReviewCount: 0,
            lastInquiryCount: 0
        };

        // API Helper Functions
        async function apiCall(endpoint, options = {}) {
            try {
                const response = await fetch(endpoint, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });
                const data = await response.json();
                if (!data.success) {
                    throw new Error(data.error || 'API call failed');
                }
                return data.data;
            } catch (error) {
                console.error('API Error:', error);
                alert('ì„œë²„ì™€ì˜ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                throw error;
            }
        }

        // Load data from API on startup
        async function loadAllData() {
            try {
                // Load reviews from API
                const reviewsData = await apiCall('/api/reviews');
                reviews = reviewsData || [];
                
                // Load inquiries from API
                const inquiriesData = await apiCall('/api/inquiries');
                inquiries = inquiriesData || [];
                
                // Load regions from API (for resort management)
                try {
                    const regionsData = await apiCall('/api/regions');
                    console.log('Loaded regions:', regionsData?.length || 0);
                    // Store regions for later use
                    window.regionsData = regionsData || [];
                } catch (error) {
                    console.error('Failed to load regions:', error);
                    window.regionsData = [];
                }
                
                // Load resorts from API
                try {
                    const resortsData = await apiCall('/api/resorts');
                    console.log('Loaded resorts:', resortsData?.length || 0);
                    // Store resorts for later use
                    window.resortsData = resortsData || [];
                } catch (error) {
                    console.error('Failed to load resorts:', error);
                    window.resortsData = [];
                }
                
                // Update notification counts
                notificationSettings.lastReviewCount = reviews.length;
                notificationSettings.lastInquiryCount = inquiries.length;
                localStorage.setItem('notificationSettings', JSON.stringify(notificationSettings));
                
                console.log('Loaded reviews:', reviews.length, 'inquiries:', inquiries.length, 'regions:', window.regionsData?.length || 0, 'resorts:', window.resortsData?.length || 0);
            } catch (error) {
                console.error('Failed to load data:', error);
            }
        }

        // Request browser notification permission on load
        if ('Notification' in window && notificationSettings.browserNotification) {
            if (Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        // Notification Management
        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            panel.classList.toggle('active');
            loadNotifications();
            markNotificationsAsRead();
        }

        function toggleEmailInput() {
            const enabled = document.getElementById('enableEmailNotification').checked;
            const container = document.getElementById('emailInputContainer');
            if (enabled) {
                container.classList.remove('hidden');
            } else {
                container.classList.add('hidden');
            }
        }

        function saveNotificationSettings() {
            notificationSettings.browserNotification = document.getElementById('enableBrowserNotification').checked;
            notificationSettings.emailNotification = document.getElementById('enableEmailNotification').checked;
            notificationSettings.email = document.getElementById('notificationEmail').value;
            
            localStorage.setItem('notificationSettings', JSON.stringify(notificationSettings));
            
            // Request browser notification permission
            if (notificationSettings.browserNotification && 'Notification' in window) {
                if (Notification.permission === 'default') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            alert('ë¸Œë¼ìš°ì € ì•Œë¦¼ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
                        }
                    });
                } else if (Notification.permission === 'granted') {
                    alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    alert('ë¸Œë¼ìš°ì € ì•Œë¦¼ ê¶Œí•œì´ ì°¨ë‹¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ í—ˆìš©í•´ì£¼ì„¸ìš”.');
                }
            } else {
                alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        }

        function saveSoundSettings() {
            // Just save the checkbox state
            const settings = JSON.parse(localStorage.getItem('notificationSettings')) || {};
            settings.browserNotification = document.getElementById('enableBrowserNotification').checked;
            localStorage.setItem('notificationSettings', JSON.stringify(settings));
        }

        function loadNotifications() {
            const list = document.getElementById('notificationList');
            
            if (notifications.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #7f8c8d; padding: 1rem;">ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }
            
            list.innerHTML = '';
            notifications.slice().reverse().forEach(notif => {
                const item = document.createElement('div');
                item.className = `notification-item ${notif.read ? '' : 'unread'}`;
                
                const icon = notif.type === 'review' ? 'â­' : 'ğŸ“§';
                const time = new Date(notif.timestamp).toLocaleString('ko-KR');
                
                item.innerHTML = `
                    <div class="notification-title">${icon} ${notif.title}</div>
                    <div class="notification-text">${notif.message}</div>
                    <div class="notification-time">${time}</div>
                `;
                
                list.appendChild(item);
            });
        }

        function markNotificationsAsRead() {
            notifications.forEach(n => n.read = true);
            localStorage.setItem('notifications', JSON.stringify(notifications));
            updateNotificationBadge();
        }

        function updateNotificationBadge() {
            const unreadCount = notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notificationBadge');
            
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        function addNotification(type, title, message) {
            const notification = {
                id: Date.now().toString(),
                type: type,
                title: title,
                message: message,
                timestamp: Date.now(),
                read: false
            };
            
            notifications.push(notification);
            localStorage.setItem('notifications', JSON.stringify(notifications));
            updateNotificationBadge();
            
            // Browser notification
            if (notificationSettings.browserNotification && 'Notification' in window && Notification.permission === 'granted') {
                new Notification('ì„ ìƒ¤ì¸íˆ¬ì–´ - ' + title, {
                    body: message,
                    icon: '/favicon.ico',
                    badge: '/favicon.ico'
                });
            }
            
            // Email notification (would need backend)
            if (notificationSettings.emailNotification && notificationSettings.email) {
                // This would normally call a backend API to send email
                console.log(`Email would be sent to: ${notificationSettings.email}`);
                console.log(`Subject: ${title}`);
                console.log(`Body: ${message}`);
            }
        }

        // Check for new reviews and inquiries
        async function checkForNewContent() {
            try {
                // Reload data from API
                await loadAllData();
                
                const currentReviewCount = reviews.length;
                const currentInquiryCount = inquiries.length;
                
                if (notificationSettings.lastReviewCount > 0 && currentReviewCount > notificationSettings.lastReviewCount) {
                    const newCount = currentReviewCount - notificationSettings.lastReviewCount;
                    addNotification('review', 'ìƒˆë¡œìš´ í›„ê¸°', `${newCount}ê°œì˜ ìƒˆë¡œìš´ í›„ê¸°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                }
                
                if (notificationSettings.lastInquiryCount > 0 && currentInquiryCount > notificationSettings.lastInquiryCount) {
                    const newCount = currentInquiryCount - notificationSettings.lastInquiryCount;
                    addNotification('inquiry', 'ìƒˆë¡œìš´ ë¬¸ì˜', `${newCount}ê°œì˜ ìƒˆë¡œìš´ ë¬¸ì˜ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                }
                
                notificationSettings.lastReviewCount = currentReviewCount;
                notificationSettings.lastInquiryCount = currentInquiryCount;
                localStorage.setItem('notificationSettings', JSON.stringify(notificationSettings));
            } catch (error) {
                console.error('Failed to check for new content:', error);
            }
        }

        // Initialize notification settings UI
        function initializeNotificationSettings() {
            document.getElementById('enableBrowserNotification').checked = notificationSettings.browserNotification || false;
            document.getElementById('enableEmailNotification').checked = notificationSettings.emailNotification || false;
            document.getElementById('notificationEmail').value = notificationSettings.email || '';
            
            if (notificationSettings.emailNotification) {
                document.getElementById('emailInputContainer').classList.remove('hidden');
            }
            
            updateNotificationBadge();
        }

        // Periodically check for new content (every 30 seconds)
        setInterval(checkForNewContent, 30000);

        // Tab Management
        function switchTab(tab) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            
            // Show selected tab
            if (tab === 'resort') {
                document.getElementById('resortTab').classList.add('active');
                document.querySelectorAll('.tab-button')[0].classList.add('active');
            } else if (tab === 'review') {
                document.getElementById('reviewTab').classList.add('active');
                document.querySelectorAll('.tab-button')[1].classList.add('active');
                loadReviews();
            } else if (tab === 'inquiry') {
                document.getElementById('inquiryTab').classList.add('active');
                document.querySelectorAll('.tab-button')[2].classList.add('active');
                loadInquiries('all');
            }
        }

        // Login
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const password = document.getElementById('passwordInput').value;
            
            if (password === ADMIN_PASSWORD) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                loadAllData().then(() => {
                    initializeDestinations();
                    initializeNotificationSettings();
                    checkForNewContent();
                });
            } else {
                document.getElementById('loginError').classList.remove('hidden');
            }
        });

        function logout() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('passwordInput').value = '';
            document.getElementById('loginError').classList.add('hidden');
        }

        // Initialize Destinations
        function initializeDestinations() {
            const grid = document.getElementById('destinationGrid');
            grid.innerHTML = '';
            
            Object.keys(DESTINATIONS).forEach(dest => {
                const card = document.createElement('div');
                card.className = 'destination-card';
                card.innerHTML = `
                    <div class="destination-icon">${DESTINATIONS[dest].icon}</div>
                    <div class="destination-name">${dest}</div>
                `;
                card.onclick = () => selectDestination(dest);
                grid.appendChild(card);
            });
            
            updateBreadcrumb('ëª©ì ì§€ ì„ íƒ');
        }

        // Select Destination
        function selectDestination(destination) {
            currentDestination = destination;
            
            document.getElementById('destinationStep').classList.add('hidden');
            document.getElementById('regionStep').classList.remove('hidden');
            document.getElementById('backBtn').classList.remove('hidden');
            
            document.getElementById('currentDestinationName').textContent = destination;
            
            const grid = document.getElementById('regionGrid');
            grid.innerHTML = '';
            
            DESTINATIONS[destination].regions.forEach(region => {
                const card = document.createElement('div');
                card.className = 'region-card';
                card.innerHTML = `<div class="region-name">${region}</div>`;
                card.onclick = () => selectRegion(region);
                grid.appendChild(card);
            });
            
            updateBreadcrumb(`ëª©ì ì§€ ì„ íƒ > ${destination}`);
        }

        // Select Region
        function selectRegion(region) {
            currentRegion = region;
            
            document.getElementById('regionStep').classList.add('hidden');
            document.getElementById('resortStep').classList.remove('hidden');
            
            document.getElementById('currentRegionName').textContent = `${currentDestination} - ${region}`;
            
            loadResorts();
            updateBreadcrumb(`ëª©ì ì§€ ì„ íƒ > ${currentDestination} > ${region}`);
        }

        // Go Back
        function goBack() {
            if (document.getElementById('resortStep').classList.contains('hidden') === false) {
                // Resort -> Region
                document.getElementById('resortStep').classList.add('hidden');
                document.getElementById('regionStep').classList.remove('hidden');
                hideResortForm();
                updateBreadcrumb(`ëª©ì ì§€ ì„ íƒ > ${currentDestination}`);
            } else if (document.getElementById('regionStep').classList.contains('hidden') === false) {
                // Region -> Destination
                document.getElementById('regionStep').classList.add('hidden');
                document.getElementById('destinationStep').classList.remove('hidden');
                document.getElementById('backBtn').classList.add('hidden');
                currentDestination = null;
                updateBreadcrumb('ëª©ì ì§€ ì„ íƒ');
            }
        }

        // Update Breadcrumb
        function updateBreadcrumb(text) {
            document.getElementById('breadcrumb').textContent = text;
        }

        // Resort Management
        function showResortForm() {
            document.getElementById('resortForm').classList.add('active');
            editingResortId = null;
            document.getElementById('resortDataForm').reset();
        }

        function hideResortForm() {
            document.getElementById('resortForm').classList.remove('active');
            editingResortId = null;
            document.getElementById('resortDataForm').reset();
        }

        document.getElementById('resortDataForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const resortData = {
                id: editingResortId || Date.now().toString(),
                destination: currentDestination,
                region: currentRegion,
                name: document.getElementById('resortName').value,
                type: document.getElementById('resortType').value,
                image: document.getElementById('resortImage').value,
                price: document.getElementById('resortPrice').value,
                description: document.getElementById('resortDescription').value,
                features: document.getElementById('resortFeatures').value.split(',').map(f => f.trim()),
                enabled: true
            };
            
            const key = `${currentDestination}_${currentRegion}`;
            if (!resorts[key]) resorts[key] = [];
            
            if (editingResortId) {
                const index = resorts[key].findIndex(r => r.id === editingResortId);
                resorts[key][index] = resortData;
            } else {
                resorts[key].push(resortData);
            }
            
            localStorage.setItem('resorts', JSON.stringify(resorts));
            hideResortForm();
            loadResorts();
        });

        function loadResorts() {
            const key = `${currentDestination}_${currentRegion}`;
            const regionResorts = resorts[key] || [];
            
            const list = document.getElementById('resortList');
            list.innerHTML = '';
            
            if (regionResorts.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #7f8c8d; padding: 2rem;">ë“±ë¡ëœ ë¦¬ì¡°íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            regionResorts.forEach(resort => {
                const item = document.createElement('div');
                item.className = 'resort-item';
                item.style.opacity = resort.enabled ? '1' : '0.5';
                
                item.innerHTML = `
                    <div class="resort-info">
                        <h4>${resort.name} ${resort.enabled ? '' : '(ë¹„í™œì„±í™”)'}</h4>
                        <p>${resort.type || ''} ${resort.price ? 'Â· ' + resort.price : ''}</p>
                    </div>
                    <div class="resort-actions">
                        <button class="btn-toggle ${resort.enabled ? 'active' : ''}" onclick="toggleResort('${resort.id}')">
                            ${resort.enabled ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}
                        </button>
                        <button class="btn-edit" onclick="editResort('${resort.id}')">ìˆ˜ì •</button>
                        <button class="btn-delete" onclick="deleteResort('${resort.id}')">ì‚­ì œ</button>
                    </div>
                `;
                
                list.appendChild(item);
            });
        }

        function editResort(id) {
            const key = `${currentDestination}_${currentRegion}`;
            const resort = resorts[key].find(r => r.id === id);
            
            editingResortId = id;
            document.getElementById('resortName').value = resort.name;
            document.getElementById('resortType').value = resort.type;
            document.getElementById('resortImage').value = resort.image;
            document.getElementById('resortPrice').value = resort.price;
            document.getElementById('resortDescription').value = resort.description;
            document.getElementById('resortFeatures').value = resort.features.join(', ');
            
            showResortForm();
        }

        function deleteResort(id) {
            if (!confirm('ì´ ë¦¬ì¡°íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const key = `${currentDestination}_${currentRegion}`;
            resorts[key] = resorts[key].filter(r => r.id !== id);
            localStorage.setItem('resorts', JSON.stringify(resorts));
            loadResorts();
        }

        function toggleResort(id) {
            const key = `${currentDestination}_${currentRegion}`;
            const resort = resorts[key].find(r => r.id === id);
            resort.enabled = !resort.enabled;
            localStorage.setItem('resorts', JSON.stringify(resorts));
            loadResorts();
        }

        // Review Management
        function showReviewForm() {
            document.getElementById('reviewForm').classList.add('active');
            editingReviewId = null;
            document.getElementById('reviewDataForm').reset();
        }

        function hideReviewForm() {
            document.getElementById('reviewForm').classList.remove('active');
            editingReviewId = null;
            document.getElementById('reviewDataForm').reset();
        }

        // Image preview functionality
        document.getElementById('reviewImages')?.addEventListener('change', function(e) {
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';
            
            const files = Array.from(e.target.files);
            files.forEach((file, index) => {
                if (file.size > 5 * 1024 * 1024) {
                    alert(`${file.name}ì€(ëŠ”) 5MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.`);
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = document.createElement('img');
                    img.src = event.target.result;
                    img.style.width = '100px';
                    img.style.height = '100px';
                    img.style.objectFit = 'cover';
                    img.style.borderRadius = '8px';
                    img.style.border = '2px solid #667eea';
                    preview.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        });

        document.getElementById('reviewDataForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Upload images first if any
            let imageUrls = [];
            const imageFiles = document.getElementById('reviewImages')?.files;
            
            if (imageFiles && imageFiles.length > 0) {
                try {
                    const formData = new FormData();
                    for (let file of imageFiles) {
                        formData.append('files', file);
                    }
                    
                    const uploadResponse = await fetch('/api/upload', {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (uploadResponse.ok) {
                        const uploadResult = await uploadResponse.json();
                        imageUrls = uploadResult.urls || [];
                    }
                } catch (error) {
                    console.error('Image upload failed:', error);
                    alert('ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê³„ì† ì§„í–‰í•©ë‹ˆë‹¤.');
                }
            }
            
            const reviewData = {
                id: editingReviewId || undefined,
                destination: 'ê¸°íƒ€', // ëª©ì ì§€ëŠ” ë‚˜ì¤‘ì— ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡
                title: document.getElementById('reviewTitle')?.value || document.getElementById('reviewResort').value || 'ë¦¬ì¡°íŠ¸ í›„ê¸°',
                author_name: document.getElementById('reviewAuthor').value,
                content: document.getElementById('reviewContent').value,
                rating: parseInt(document.getElementById('reviewRating').value),
                travel_date: document.getElementById('reviewDate').value,
                status: 'approved',
                is_featured: false,
                image_url: imageUrls[0] || null,
                gallery_images: imageUrls.length > 1 ? JSON.stringify(imageUrls) : null
            };
            
            try {
                if (editingReviewId) {
                    // Update existing review
                    await apiCall(`/api/reviews?id=${editingReviewId}`, {
                        method: 'PATCH',
                        body: JSON.stringify(reviewData)
                    });
                } else {
                    // Create new review
                    await apiCall('/api/reviews', {
                        method: 'POST',
                        body: JSON.stringify(reviewData)
                    });
                }
                
                // Reload reviews
                await loadAllData();
                hideReviewForm();
                loadReviews();
                alert('í›„ê¸°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (error) {
                console.error('Failed to save review:', error);
                alert('í›„ê¸° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        });

        function loadReviews() {
            const list = document.getElementById('reviewList');
            list.innerHTML = '';
            
            if (reviews.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #7f8c8d; padding: 2rem;">ë“±ë¡ëœ í›„ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            reviews.forEach(review => {
                const stars = 'â­'.repeat(review.rating);
                const images = review.gallery_images ? JSON.parse(review.gallery_images) : (review.image_url ? [review.image_url] : []);
                const imageGallery = images.length > 0 ? `
                    <div style="display: flex; gap: 5px; margin-top: 10px; flex-wrap: wrap;">
                        ${images.map(img => `<img src="${img}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">`).join('')}
                    </div>
                ` : '';
                
                list.innerHTML += `
                    <div class="resort-card">
                        <h3>${review.title || 'ì œëª© ì—†ìŒ'}</h3>
                        <p style="color: #e67e22; font-weight: 600;">${stars} (${review.rating}ì )</p>
                        <p><strong>ì‘ì„±ì:</strong> ${review.author_name}</p>
                        <p><strong>ì—¬í–‰ì¼:</strong> ${review.travel_date || 'ë¯¸ì •'}</p>
                        <p style="margin-top: 10px; color: #555; white-space: pre-wrap;">${review.content}</p>
                        ${imageGallery}
                        <div style="margin-top: 15px;">
                            <label class="toggle-switch">
                                <input type="checkbox" ${review.status === 'approved' ? 'checked' : ''} 
                                    onchange="toggleReviewStatus('${review.id}', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                            <span style="margin-left: 10px;">${review.status === 'approved' ? 'ìŠ¹ì¸ë¨' : 'ëŒ€ê¸°ì¤‘'}</span>
                        </div>
                        <div class="card-actions">
                            <button class="btn-edit" onclick="editReview('${review.id}')">ìˆ˜ì •</button>
                            <button class="btn-delete" onclick="deleteReview('${review.id}')">ì‚­ì œ</button>
                        </div>
                    </div>
                `;
            });
        }
                const stars = 'â­'.repeat(review.rating || 5);
                const item = document.createElement('div');
                item.className = 'resort-item';
                item.style.opacity = review.status === 'approved' ? '1' : '0.5';
                
                item.innerHTML = `
                    <div class="resort-info">
                        <h4>${review.author_name} - ${review.title} ${review.status !== 'approved' ? '(ë¯¸ìŠ¹ì¸)' : ''}</h4>
                        <p>${stars} Â· ${review.travel_date || review.created_at}</p>
                        <p style="margin-top: 0.5rem; color: #555;">${review.content.substring(0, 100)}${review.content.length > 100 ? '...' : ''}</p>
                    </div>
                    <div class="resort-actions">
                        <button class="btn-toggle ${review.status === 'approved' ? 'active' : ''}" onclick="toggleReview('${review.id}')">
                            ${review.status === 'approved' ? 'ìŠ¹ì¸ë¨' : 'ë¯¸ìŠ¹ì¸'}
                        </button>
                        <button class="btn-edit" onclick="editReview('${review.id}')">ìˆ˜ì •</button>
                        <button class="btn-delete" onclick="deleteReview('${review.id}')">ì‚­ì œ</button>
                    </div>
                `;
                
                list.appendChild(item);
            });
        }

        function editReview(id) {
            const review = reviews.find(r => r.id === id);
            
            editingReviewId = id;
            document.getElementById('reviewAuthor').value = review.author_name;
            document.getElementById('reviewResort').value = review.title;
            document.getElementById('reviewRating').value = review.rating;
            document.getElementById('reviewDate').value = review.travel_date || '';
            document.getElementById('reviewContent').value = review.content;
            
            showReviewForm();
        }

        async function deleteReview(id) {
            if (!confirm('ì´ í›„ê¸°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                await apiCall(`/api/reviews?id=${id}`, { method: 'DELETE' });
                await loadAllData();
                loadReviews();
                alert('í›„ê¸°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (error) {
                console.error('Failed to delete review:', error);
            }
        }

        async function toggleReview(id) {
            const review = reviews.find(r => r.id === id);
            const newStatus = review.status === 'approved' ? 'pending' : 'approved';
            
            try {
                await apiCall(`/api/reviews?id=${id}`, {
                    method: 'PATCH',
                    body: JSON.stringify({ status: newStatus })
                });
                await loadAllData();
                loadReviews();
            } catch (error) {
                console.error('Failed to toggle review:', error);
            }
        }

        // Inquiry Management
        function loadInquiries(filter) {
            const list = document.getElementById('inquiryList');
            list.innerHTML = '';
            
            let filteredInquiries = inquiries;
            if (filter === 'pending') {
                filteredInquiries = inquiries.filter(i => i.status === 'pending');
            } else if (filter === 'completed') {
                filteredInquiries = inquiries.filter(i => i.status === 'completed');
            }
            
            if (filteredInquiries.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #7f8c8d; padding: 2rem;">ë¬¸ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            filteredInquiries.forEach(inquiry => {
                const statusColor = inquiry.status === 'completed' ? '#27ae60' : '#f39c12';
                const statusText = inquiry.status === 'completed' ? 'ë‹µë³€ì™„ë£Œ' : 'ëŒ€ê¸°ì¤‘';
                
                const item = document.createElement('div');
                item.className = 'resort-item';
                
                item.innerHTML = `
                    <div class="resort-info">
                        <h4>${inquiry.name} - ${inquiry.email}</h4>
                        <p style="color: ${statusColor}; font-weight: 600;">${statusText} Â· ${new Date(inquiry.created_at).toLocaleDateString('ko-KR')}</p>
                        <p style="margin-top: 0.5rem;"><strong>ë¬¸ì˜:</strong> ${inquiry.subject || inquiry.message.substring(0, 50)}</p>
                        <p style="margin-top: 0.5rem; color: #555;">${inquiry.message}</p>
                        ${inquiry.admin_reply ? `<p style="margin-top: 0.5rem; padding: 0.5rem; background: #e8f5e9; border-radius: 4px;"><strong>ë‹µë³€:</strong> ${inquiry.admin_reply}</p>` : ''}
                    </div>
                    <div class="resort-actions">
                        <button class="btn-edit" onclick="replyInquiry('${inquiry.id}')">
                            ${inquiry.admin_reply ? 'ë‹µë³€ ìˆ˜ì •' : 'ë‹µë³€í•˜ê¸°'}
                        </button>
                        <button class="btn-delete" onclick="deleteInquiry('${inquiry.id}')">ì‚­ì œ</button>
                    </div>
                `;
                
                list.appendChild(item);
            });
        }

        async function replyInquiry(id) {
            const inquiry = inquiries.find(i => i.id === id);
            const reply = prompt('ë‹µë³€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:', inquiry.admin_reply || '');
            
            if (reply !== null && reply.trim() !== '') {
                try {
                    await apiCall(`/api/inquiries?id=${id}`, {
                        method: 'PATCH',
                        body: JSON.stringify({ 
                            admin_reply: reply,
                            status: 'completed'
                        })
                    });
                    await loadAllData();
                    loadInquiries('all');
                    alert('ë‹µë³€ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } catch (error) {
                    console.error('Failed to reply to inquiry:', error);
                }
            }
        }

        async function deleteInquiry(id) {
            if (!confirm('ì´ ë¬¸ì˜ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                await apiCall(`/api/inquiries?id=${id}`, { method: 'DELETE' });
                await loadAllData();
                loadInquiries('all');
                alert('ë¬¸ì˜ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (error) {
                console.error('Failed to delete inquiry:', error);
            }
        }

        function filterInquiries(filter) {
            loadInquiries(filter);
        }
    </script>
</body>
</html>
